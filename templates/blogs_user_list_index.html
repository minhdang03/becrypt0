<div class="container mx-auto px-4 pb-1 pt-1">
    <div class="mb-4">
        <!-- Nội dung khác có thể thêm vào đây -->
    </div>
    <div id="blog-container" class="flex flex-col gap-4">
        <!-- Các blog sẽ được thêm vào đây -->
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js" async></script>
<script>
    let currentPage = 1;
    const perPage = 10;
    let loading = false;

    function loadBlogs(page, order) {
        if (loading) return;
        loading = true;
        $('#loading').show();

        $.get(`/blogs_user/?page=${page}&per_page=${perPage}&format=json&sort=created_at&order=${order}`, function(data) {
            data.blogs.forEach(blog => {
                $('#blog-container').append(`
<a href="/blogs_user/${blog.blog_id}" class="text-black no-underline blog-title">
    <div class="blog-card bg-white border border-gray-300 rounded-lg overflow-hidden transform transition-transform duration-300 hover:scale-105 mb-5 flex flex-col md:flex-row">
        ${blog.first_image_url ? `<img data-src="${blog.first_image_url}" alt="${blog.title}" class="lazyload w-full md:w-1/3 h-64 object-cover">` : ''}
        <div class="p-4 flex flex-col justify-between flex-grow">
            <h2 class="text-lg font-semibold">${blog.title}</h2>
            <p class="text-gray-600 mt-2">${blog.author}</p>
        </div>
    </div>
</a>
                `);
            });

            if (data.current_page >= data.pages) {
                $(window).off('scroll', onScroll);
            }

            loading = false;
            $('#loading').hide();
        });
    }

    function onScroll() {
        if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
            loadBlogs(++currentPage, $('#sort-order').val());
        }
    }

    $(document).ready(function() {
        // Kiểm tra sự kiện click cho dropdown menu
        $('.dropdown-toggle').dropdown();

        // Kiểm tra sự kiện cuộn
        $(window).on('scroll', onScroll);

        // Tải bài viết đầu tiên khi trang được tải
        loadBlogs(currentPage, 'desc');

        // Xử lý thay đổi thứ tự sắp xếp
        $('#sort-order').change(function() {
            currentPage = 1;
            $('#blog-container').empty();
            loadBlogs(currentPage, $(this).val());
        });

                // Lấy hình nền từ server và đặt làm background
                $.get('/slideshow/get_background_image', function(data) {
            if (data.url) {
                $('body').css('background-image', `url(${data.url})`);
            }
        });

        
    });
</script>